# üêã KalshiWhale Backend - Developer Documentation

## üìã **Overview**

Complete backend implementation for KalshiWhale crypto whale tracker. A **full-stack FastAPI application** with WebSocket support for real-time crypto market data.

## üöÄ **Features**

### ‚úÖ **Core Functionality**
- **Real-time WebSocket connections** for live data updates
- **FastAPI REST API** for market data and application status
- **Background data collection** from Kalshi API every 2 minutes
- **WebSocket broadcasting** to all connected clients
- **CORS support** for frontend integration

### ‚úÖ **API Endpoints**
- `GET /` - Serve main application (HTML)
- `GET /api/markets` - Get all market data
- `GET /api/status` - Application status and statistics
- `GET /api/top-markets` - Top 5 markets by volume
- `GET /api/whale-alerts` - High-volume markets (whale activity)
- `POST /api/refresh` - Manually trigger data refresh
- `WS /ws` - WebSocket endpoint for real-time updates

### ‚úÖ **Developer Features**
- **Hot reloading** in development mode
- **Comprehensive logging** with structured output
- **Error handling** and graceful degradation
- **Environment configuration** via `.env` files
- **Static file serving** for frontend assets
- **WebSocket connection management** with auto-reconnect

## üõ†Ô∏è **Development Setup**

### **Prerequisites**
- Python 3.8 or higher
- pip (Python package manager)
- Git

### **Quick Start**
```bash
# Clone the repository
git clone <repository-url>
cd kalshi_whale_backend

# Run the startup script
chmod +x start.sh
./start.sh
```

### **Manual Setup**
```bash
# Create virtual environment
python3 -m venv venv

# Activate virtual environment
source venv/bin/activate  # Linux/Mac
# or
venv\\Scripts\\activate     # Windows

# Install dependencies
pip install -r requirements.txt

# Configure environment (optional)
cp .env.example .env

# Start development server
python main.py
```

### **Development Server**
- **URL**: http://localhost:8000
- **API Documentation**: http://localhost:8000/docs (Auto-generated by FastAPI)
- **WebSocket Endpoint**: ws://localhost:8000/ws
- **Reload**: Automatic on file changes (development mode)

## üåê **API Documentation**

### **Base URL**
- **Development**: http://localhost:8000
- **Production**: https://your-domain.com

### **REST API Endpoints**

#### **GET /api/markets**
Get all market data from Kalshi.

**Response:**
```json
{
  "markets": [
    {
      "ticker_symbol": "BTCJAN2025",
      "volume": 2500000,
      "volume_millions": 2.5,
      "last_updated": "2025-11-04T00:09:24",
      "status": "open"
    }
  ],
  "count": 50,
  "timestamp": "2025-11-04T00:09:24"
}
```

#### **GET /api/status**
Get application status and statistics.

**Response:**
```json
{
  "status": "running",
  "timestamp": "2025-11-04T00:09:24",
  "last_update": "2025-11-04T00:09:20",
  "active_connections": 5,
  "total_markets": 150,
  "websocket_enabled": true
}
```

#### **GET /api/top-markets**
Get top 5 markets by volume.

**Response:**
```json
{
  "markets": [...],
  "count": 5
}
```

#### **GET /api/whale-alerts**
Get markets with high volume (>$1M).

**Response:**
```json
{
  "alerts": [...],
  "count": 3,
  "threshold": 1000000
}
```

#### **POST /api/refresh**
Manually trigger data refresh.

**Response:**
```json
{
  "success": true,
  "message": "Data refreshed successfully",
  "count": 150,
  "timestamp": "2025-11-04T00:09:24"
}
```

### **WebSocket Protocol**

#### **Connection**
```javascript
const ws = new WebSocket('ws://localhost:8000/ws');
```

#### **Message Types**

**Initial Data:**
```json
{
  "type": "initial_data",
  "data": {
    "markets": [...],
    "timestamp": "2025-11-04T00:09:24",
    "count": 150
  }
}
```

**Market Updates:**
```json
{
  "type": "market_update",
  "data": {
    "markets": [...],
    "timestamp": "2025-11-04T00:09:24",
    "count": 150
  }
}
```

**Heartbeat:**
```json
{
  "type": "heartbeat",
  "timestamp": "2025-11-04T00:09:24",
  "connections": 5
}
```

## ‚öôÔ∏è **Configuration**

### **Environment Variables**

Create `.env` file from `.env.example`:

```bash
# Server Configuration
PORT=8000
HOST=0.0.0.0
ENVIRONMENT=development

# API Configuration
KALSHI_API_BASE=https://api.elections.kalshi.com/trade-api/v2

# Update Configuration
UPDATE_INTERVAL_SECONDS=120

# Development Settings
RELOAD=True
DEBUG=True
```

### **Configuration Options**

| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | 8000 | Server port |
| `HOST` | 0.0.0.0 | Server host |
| `ENVIRONMENT` | development | Environment mode |
| `LOG_LEVEL` | INFO | Logging level |
| `UPDATE_INTERVAL_SECONDS` | 120 | Data update interval |

## üöÄ **Deployment**

### **Render Deployment (Free)**

1. **Create Render Account**: [render.com](https://render.com)
2. **Connect GitHub**: Import your repository
3. **Configure Service**:
   - **Name**: kalshi-whale-backend
   - **Branch**: main
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python main.py`
   - **Plan**: Free
4. **Deploy**: Click "Create Web Service"

### **Railway Deployment**

1. **Install Railway CLI**:
   ```bash
   npm install -g @railway/cli
   ```

2. **Deploy**:
   ```bash
   railway login
   railway init
   railway up
   ```

### **Docker Deployment**

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "main.py"]
```

### **Production Deployment**

For production, configure these settings:

```bash
ENVIRONMENT=production
LOG_LEVEL=WARNING
RELOAD=False
DEBUG=False
```

## üß™ **Testing**

### **API Testing**
```bash
# Test all endpoints
curl http://localhost:8000/api/status
curl http://localhost:8000/api/markets
curl http://localhost:8000/api/top-markets
curl -X POST http://localhost:8000/api/refresh
```

### **WebSocket Testing**
```bash
# Test WebSocket connection
wscat -c ws://localhost:8000/ws
```

### **Load Testing**
```bash
# Install locust for load testing
pip install locust

# Run load tests
locust -f tests/load_test.py --host=http://localhost:8000
```

## üìÅ **Project Structure**

```
kalshi_whale_backend/
‚îú‚îÄ‚îÄ main.py                 # Main FastAPI application
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ .env.example           # Environment configuration template
‚îú‚îÄ‚îÄ start.sh               # Startup script
‚îú‚îÄ‚îÄ package.json           # Node.js configuration (optional)
‚îú‚îÄ‚îÄ render.yaml            # Render deployment config
‚îú‚îÄ‚îÄ railway.json           # Railway deployment config
‚îú‚îÄ‚îÄ static/                # Static files
‚îÇ   ‚îî‚îÄ‚îÄ index.html        # Frontend application
‚îî‚îÄ‚îÄ README.md             # This file
```

## üîß **Development Tips**

### **Code Style**
- Follow PEP 8 guidelines
- Use type hints for function parameters
- Add docstrings for public functions
- Handle exceptions appropriately

### **Logging**
```python
import logging
logger = logging.getLogger(__name__)

# Usage
logger.info("Application started")
logger.error("Error occurred", exc_info=True)
```

### **WebSocket Best Practices**
- Always handle connection errors
- Implement reconnection logic
- Send heartbeats to keep connections alive
- Limit payload sizes for performance

### **Performance Optimization**
- Use asyncio for concurrent operations
- Implement connection pooling for external APIs
- Cache frequently accessed data
- Monitor memory usage for long-running processes

## üêõ **Troubleshooting**

### **Common Issues**

#### **Port Already in Use**
```bash
# Find process using port 8000
lsof -i :8000
# Kill the process
kill -9 <PID>
```

#### **WebSocket Connection Failed**
- Check firewall settings
- Verify WebSocket endpoint URL
- Ensure CORS is properly configured

#### **Data Not Updating**
- Check Kalshi API status
- Verify network connectivity
- Check logs for error messages

### **Debug Mode**
Set environment variable for detailed logging:
```bash
LOG_LEVEL=DEBUG python main.py
```

### **Memory Leaks**
Monitor memory usage:
```bash
# Monitor with ps
ps aux | grep python

# Memory profiling
pip install memory_profiler
python -m memory_profiler main.py
```

## ü§ù **Contributing**

1. **Fork the repository**
2. **Create feature branch**: `git checkout -b feature/amazing-feature`
3. **Commit changes**: `git commit -m 'Add amazing feature'`
4. **Push to branch**: `git push origin feature/amazing-feature`
5. **Open Pull Request**

### **Code Standards**
- Write tests for new features
- Update documentation
- Follow existing code style
- Add type hints

## üìÑ **License**

This project is licensed under the MIT License - see the LICENSE file for details.

## üìû **Support**

For questions and support:
- **Documentation**: This README file
- **API Docs**: http://localhost:8000/docs (when running locally)
- **Issues**: Create an issue in the repository

---

**Happy coding! üöÄ**

This backend provides a solid foundation for real-time crypto market data with WebSocket support, perfect for building modern cryptocurrency applications.